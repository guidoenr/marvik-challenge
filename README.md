
# marvik-challenge by @guidoenr

## Descripción
Este proyecto es una API construida con **Gin** en Go y **PostgreSQL**. 

Resuelve el enunciado recibido por mail usando tecnologias como Docker, Makefile, PostgreSQL para los datos, y Golang para el server.

## Requisitos
Para ejecutar la aplicación, deberias tener instalados lo siguiente:

- [**Docker**](https://www.docker.com/)
- [**Make**](https://www.geeksforgeeks.org/how-to-install-make-on-ubuntu/)


## Cómo ejecutar la aplicación
podes ejecutar todo con un solo comando:

```shell
make build run
```
esperar a que la api este lista, donde veras en la terminal algo como:
```shell
=====================================
   Marvik Challenge by @guidoenr     
=====================================
2025-01-15T13:24:55Z INF APi is ready !
2025-01-15T13:24:55Z INF checkout README.md for further details on usage :)
-----------------
2025-01-15T13:24:55Z INF endpoints:
2025-01-15T13:24:55Z INF http://localhost:8080/users
2025-01-15T13:24:55Z INF http://localhost:8080/organizations
2025-01-15T13:24:55Z INF http://localhost:8080/counters
2025-01-15T13:24:55Z INF http://localhost:8080/
```

O en caso de que querer hacer el paso-a-paso, puedes:

1. **construir la imagen de Docker**:
   ```bash
   make build
   ```

2. **iniciar el container**:
   ```bash
   make run
   ```

3. **limpiar containers/imagenes**:
   ```bash
   make clean
   ```


4. **entrar al container**:
   ```bash
   make exec
   ```
   
## Endpoints
debajo esta el listado de todos los endpoints disponible para la API con ejemplos de respuestas al acceder.

### 1. **`GET /`**
```bash
curl -X GET http://localhost:8080/
```

```json
{
  "status": "ready"
}
```

### 2. **`GET /users`**
todos los usuarios y la lista de organizaciones a las que pertenecen.

> [!IMPORTANT]
> este endpoint tiene la capacidad de recibir **filtros** en forma de QueryParams

por ejemplo:
```bash
curl -X GET "http://localhost:8080/users?name=Guido"
curl -X GET "http://localhost:8080/users?organization=Veritone"
curl -X GET "http://localhost:8080/users?email=john.doe@example.com"
curl -X GET "http://localhost:8080/users?name=John?surname=Doe?email=@john.doe@example.com"
```


```bash
curl -X GET "http://localhost:8080/users?name=Guido&"
```

```json
[
  {
    "id": 1,
    "name": "Guido",
    "surname": "Enrique",
    "email": "guidoenr4@gmail.com",
    "organizations": [
      {
        "id": 1,
        "name": "Veritone"
      }
    ]
  }
]
```

### 3. **`GET /organizations`**
todas las organizaciones y la lista de usuarios que estan dentro.
```bash
curl -X GET http://localhost:8080/organizations
```

```json
[
  {
    "id": 1,
    "name": "Veritone",
    "users": [
      {
        "id": 1,
        "name": "Guido",
        "surname": "Enrique",
        "email": "guidoenr4@gmail.com"
      }
    ]
  }
]
```

### 4. **`GET /counters`**
un mapa de contadores por aca endpoint disponible.
> (el propio endpoint `/counters` tambien tiene un contador y es actualizado)

```bash
curl -X GET http://localhost:8080/counters
```
```json
{
  "/": 10,
  "/users": 5,
  "/counters": 2,
  "/organizations": 3
}
```

## DB Schema

el esquema de la base de datos contiene dos tablas principales: **Usuarios** y **Organizaciones**, con una relación de muchos a muchos entre ellas.

```
users
-----------------------------------------------
| id | name  | surname  | email                |
-----------------------------------------------
| 1  | John   | Doe     | john.doe@example.com |
-----------------------------------------------
| 2  | Guido  | Enrique | guidoenr4@gmail.com  |
-----------------------------------------------
... and more..

organizations
--------------------
| id   | name      |
--------------------
| 1    | Veritone  |
--------------------
| 2    | Slingr    |
--------------------
... and more

user_organizations (generated by `gorm` many2many)
-----------------------------
| user_id | organization_id |
-----------------------------
| 1       | 1               |
-----------------------------
```

## Testing
existe la capacidad de correr tests, haciendo:
```bash
make test
```

esto iniciara las pruebas y verificará que todo funcione correctamente. 

> [!IMPORTANT]
> El server debe estar corriendo (`:8080`) para ejecutar las pruebas.
> dado que estas hacen request literales a los endpoints reales.
> (de todas formas los tests no se ejecutaran si la API no esta levantada)

